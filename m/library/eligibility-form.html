<div id=D__ID>
    <!--third html start -->
    <div class="container mt-95 mb-3">
        <div class="row">
            <!-- form container start -->
            <div class="col-12 col-lg-12 col-md-12 col-sm-12 mx-auto formbox">
                <div class="row">
                    <div class="col-12">
                        <!-- form start -->
                        <form id="F__ID">
                            <h3 id="title__ID"></h3>
                            <!-- participant part for all tsak forms -------------------->
                            <div id="participant_div__ID">
                                <div class="form-group">
                                    <fieldset class="subquestions">
                                        <label><span class="">Participant</span>
                                            <input type=text name="Participant" class=form-control id=Participant__ID
                                                data-id="Participant" />
                                        </label>
                                        <label><span class="">Participant ID</span>
                                            <input type=text name="Participant_uid" id=Participant_uid__ID class=form-control readonly />
                                        </label>
                                    </fieldset>
                                </div>
                            </div>
                            <!-- form group -->
                            <div class="form-group">
                                <div class="questiongroup ">
                                    <fieldset class="">
                                        <label><span class="">Is the participant 50 to 75 years of age? ( <span id="age__ID">-</span> )</span></label><br>
                                        <label class="radiobuttons">
                                          <input type="radio" name="age" value="0" >
                                          <span class="checkmark"></span> No</label><br>
                                        <label class="radiobuttons">
                                          <input type="radio" name="age" value="1">
                                          <span class="checkmark"></span> Yes
                                        </label><br>                                          
                                    </fieldset>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="questiongroup ">
                                    <fieldset class="">
                                        <label><span class="">Did the participant screen positive to sleep apnoea (ODI ≥10)? ( <span id="odi__ID">-</span> )</span></label><br>
                                        <label class="radiobuttons">
                                          <input type="radio" name="wristox_inclusion" value="0" >
                                          <span class="checkmark"></span> No</label><br>
                                        <label class="radiobuttons">
                                          <input type="radio" name="wristox_inclusion" value="1">
                                          <span class="checkmark"></span> Yes</label><br>
                                      </fieldset>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="questiongroup ">
                                    <fieldset class="">
                                        <label><span class="">MMSE ≥ 24? ( <span id="mmse__ID">No MMSE available, please check N/A</span> )</span></label><br>
                                        <label class="radiobuttons">
                                          <input type="radio" name="pre_scre_mmse_inclusion" value="0" >
                                          <span class="checkmark"></span> No</label><br>
                                        <label class="radiobuttons">
                                          <input type="radio" name="pre_scre_mmse_inclusion" value="1">
                                          <span class="checkmark"></span> Yes</label><br>
                                          <label class="radiobuttons">
                                            <input type="radio" name="pre_scre_mmse_inclusion" value="NA">
                                            <span class="checkmark"></span> N/A</label><br>
                                      </fieldset>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="questiongroup ">
                                    <h4>Eligibility</h4>
                                    <button type="button" id="btn_legend__ID" class="btn btn-primary mb-1 mt-0 mx-0 p-1">Check Eligibility</button>
                                    <fieldset class="">
                                        <label><span class="">Is the participant eligible? </span></label><br>
                                        <label class="radiobuttons">
                                          <input type="radio" name="pre_screening_eligibility" id="inelig__ID" value="0" >
                                          <span class="checkmark"></span> No</label>
                                        <label class="radiobuttons">
                                          <input type="radio" name="pre_screening_eligibility" id="elig__ID" value="1">
                                          <span class="checkmark"></span> Yes</label>
                                    </fieldset>
                                </div>
                            </div>
                            <div id=acceptance__ID>
                                <div class="form-group">
                                    <div class="questiongroup ">
                                        <h4>Participant screening Acceptance</h4>
                                        <fieldset class="">
                                            <label><span class="">Is participant proceeding to screening? </span></label><br>
                                            <label class="radiobuttons">
                                            <input type="radio" name="screening_acceptance" value="0" >
                                            <span class="checkmark"></span> No</label>
                                            <label class="radiobuttons">
                                            <input type="radio" name="screening_acceptance" value="1">
                                            <span class="checkmark"></span> Yes</label>
                                        </fieldset>
                                    </div>
                                    <div id=no_acceptance__ID>
                                        <div class="form-group">
                                            <div class="questiongroup ">
                                                <h4>Reason</h4>
                                                <fieldset class="">
                                                    <select class=" form-control" name="no_acceptance">
                                                        <option></option>
                                                        <option>Change mind</option>
                                                        <option>Unable to commit time to study</option>
                                                        <option>Does not want OSA to be untreated</option>
                                                        <option>Not willing to undergo certain aspects</option>
                                                        <option>Lost to follow-up</option>
                                                    </select>
                                                </fieldset>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            VmInclude: __CURRENT_PATH__/modification_status.html                        
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function F__ID() {
            //-------------------------------------
            VmInclude: '__COMPONENT__/f/form.01.js'
            VmInclude: __CURRENT_PATH__/shared-form.js
            //-------------------------------------
            var load2 = m.load;
            m.load = function () {
                load2();
                //console.log("ABC: "+JSON.stringify(m.input))
                $('#acceptance__ID').hide()                
                $('#no_acceptance__ID').hide();
                $('#F__ID input[name=pre_screening_eligibility]:not(:checked)').attr('disabled', true);
                if($("#Participant_uid__ID").val()!='' && $("#Participant_uid__ID").val()!=undefined){
                    var query_uid={"Data.Participant_uid":$("#Participant_uid__ID").val()}
                    //------------------------------
                    $('#age__ID').text(m.input.participant_record.Data.age)
                    if(parseInt(m.input.participant_record.Data.age)>74 || parseInt(m.input.participant_record.Data.age)<50 ) {
                        $('#age__ID').css('color','red');
                        if(parseInt(m.input.participant_record.Data.age)==75){
                            $('#age__ID').text(m.input.participant_record.Data.age+' and '+m.input.participant_record.Data.months+' months. Please make sure there is time to randomise!')
                        }
                    }
                    else $('#age__ID').css('color','black');
                    //------------------------------
                    jQuery.ajaxSetup({async:false});
                    $vm.request({cmd:"find",table:$vm.module_list["demographics-ps-data-reshaped"].Table,query:query_uid,limit:1},function(res){
                        //console.log(res.result.length)
                        if(res.status=='np' || res.result==undefined){
                            res.result=[];
                        }
                        if(res.status=='np'){
                            if(res.sys.tb=='on') $vm.alert("No permission. Private database table, ask the table's owner for permissions.");
                            else $vm.alert("No permission.");
                        }
                        if(res.result.length!=0){
                            if(res.result[0].Data != undefined){
                                if(res.result[0].Data.age  != undefined){
                                }
                                if(res.result[0].Data.mmse_score  != undefined){
                                    $('#mmse__ID').text(res.result[0].Data.mmse_score)
                                    if(parseInt(res.result[0].Data.mmse_score)<24 ) {
                                        $('#mmse__ID').css('color','red');
                                    }
                                    else $('#mmse__ID').css('color','black');
                                }
                            }
                        }
                    })
                    //------------------------------
                    $vm.request({cmd:"find",table:$vm.module_list["wristox-ps-data-reshaped"].Table,query:query_uid,limit:1},function(res){
                        if(res.status=='np' || res.result==undefined){
                            res.result=[];
                        }
                        if(res.status=='np'){
                            if(res.sys.tb=='on') $vm.alert("No permission. Private database table, ask the table's owner for permissions.");
                            else $vm.alert("No permission.");
                        }
                        if(res.result.length!=0){
                            if(res.result[0].Data != undefined){
                                if(res.result[0].Data.odi  != undefined){
                                    $('#odi__ID').text(res.result[0].Data.odi)
                                    if(parseInt(res.result[0].Data.odi)<10 ) {
                                        $('#odi__ID').css('color','red');
                                    }
                                    else $('#odi__ID').css('color','black');
                                }
                            }
                        }
                    })
                    jQuery.ajaxSetup({async:true});
                }
                if($('#F__ID input[name=pre_screening_eligibility]:checked').val()=='1'){
                    $('#acceptance__ID').show();               
                }
                if($('#F__ID input[name=screening_acceptance]:checked').val()=='0'){
                    $('#no_acceptance__ID').show();               
                }
            }
            //-------------------------------------
            $("input[name='pre_screening_eligibility']").change(function(){
                if($("input[name='pre_screening_eligibility']:checked").val()=='1'){
                    $('#acceptance__ID').show();               
                }
                else {
                    $('#acceptance__ID').hide();               

                }
            });
            //-------------------------------------
            $("input[name='screening_acceptance']").change(function(){
                if($("input[name='screening_acceptance']:checked").val()=='0'){
                    $('#no_acceptance__ID').show();
                }
                else {
                    $('#no_acceptance__ID').hide();
                }
            });
            //-------------------------------------
            $('#btn_legend__ID').on('click',function(){
                var mmse=0
                if($('#F__ID input[name=pre_scre_mmse_inclusion]:checked').val()=='NA' || $('#F__ID input[name=pre_scre_mmse_inclusion]:checked').val()=='1') mmse=1;
                var include=parseInt($('#F__ID input[name=age]:checked').val())+
                parseInt($('#F__ID input[name=wristox_inclusion]:checked').val())+
                mmse
                $('#F__ID input[name=pre_screening_eligibility]:not(:checked)').attr('disabled', false);
                if(include==3 ){
                    $("#elig__ID").prop("checked", true);
                    $("input[name='pre_screening_eligibility']").prop('value','1')
                    $('#acceptance__ID').show();
                }
                else {
                    $("#inelig__ID").prop("checked", true);
                    $("input[name='pre_screening_eligibility']").prop('value','0')
                    $('#acceptance__ID').hide();
                    $("input[name='screening_acceptance']").prop('value','0')
                }
                $('#F__ID input[name=pre_screening_eligibility]:not(:checked)').attr('disabled', true);
            })
            //-------------------------------------
            var before_submit=m.before_submit;
            m.before_submit=function(data,index){
                $('#F__ID input[name=pre_screening_eligibility]:not(:checked)').attr('disabled', false);
                return before_submit(data,index);
            }



        }
    </script>
    <style>
        #D__ID .mt-95 {
            max-width: 800px;
        }

        VmInclude:__CURRENT_PATH__/wappsystem-form.css
    </style>
</div>